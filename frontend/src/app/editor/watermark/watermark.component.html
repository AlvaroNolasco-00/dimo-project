<header>
    <h1>Marca de Agua</h1>
    <p>Agrega tu logo o marca de agua a tus imágenes.</p>
</header>

<div class="editor-area">
    <div class="controls-sidebar">
        <div class="control-group">
            <label>1. Imagen Base</label>
            <button class="btn secondary" (click)="triggerBaseUpload()">
                <i class="ph ph-image"></i> {{ baseImageSrc() ? 'Cambiar Imagen' : 'Subir Imagen' }}
            </button>
            <input #fileInputBase type="file" (change)="onBaseSelected($event)" accept="image/*" hidden>
        </div>

        <div class="control-group" *ngIf="baseImageSrc()">
            <label>2. Logo / Marca</label>
            <button class="btn secondary" (click)="triggerWatermarkUpload()">
                <i class="ph ph-stamp"></i> {{ watermarkImageSrc() ? 'Cambiar Logo' : 'Subir Logo' }}
            </button>
            <input #fileInputWatermark type="file" (change)="onWatermarkSelected($event)" accept="image/*" hidden>
            <p class="hint" *ngIf="watermarkImageSrc()">El logo se ha redimensionado automáticamente (max 300px).</p>
        </div>

        <div class="action-buttons" *ngIf="baseImageSrc() && watermarkImageSrc()">
            <button class="btn primary full-width" (click)="process()" [disabled]="isLoading()">
                {{ isLoading() ? 'Procesando...' : 'Aplicar Marca' }}
            </button>
        </div>
    </div>

    <div class="preview-area">
        <!-- Canvas/Preview Container -->
         <div class="canvas-container" [class.hidden]="resultImageSrc()">
            <p *ngIf="!baseImageSrc()" class="empty-state">Sube una imagen base para comenzar</p>
            <canvas #editorCanvas 
                (mousedown)="onMouseDown($event)" 
                (mousemove)="onMouseMove($event)" 
                (mouseup)="onMouseUp()"
                (mouseleave)="onMouseUp()"
                [style.cursor]="watermarkImageSrc() ? 'move' : 'default'">
            </canvas>
         </div>

         <!-- Result View -->
         <div class="result-container" *ngIf="resultImageSrc()">
             <h3>Resultado</h3>
             <img [src]="resultImageSrc()" alt="Resultado">
             <div class="result-actions">
                 <a [href]="resultImageSrc()" download="watermark-result.png" class="btn download">Descargar</a>
                 <button class="btn secondary" (click)="resultImageSrc.set(null)">Volver a Editar</button>
             </div>
         </div>
    </div>
</div>
