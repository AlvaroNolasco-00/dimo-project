<div class="editor-main-wrapper">
    <header>
        <h1>{{ title() }}</h1>
        <p>{{ description() }}</p>
    </header>

    <div class="workspace-container">
        <div class="editor-area" [class.has-not-file]="!hasFile()">
            <!-- Upload Zone -->
            @if (!hasFile()) {
            <app-editor-upload (fileSelected)="handleFile($event)">
            </app-editor-upload>
            }

            <!-- Preview Area -->
            @if (hasFile()) {
            <app-editor-preview [currentImageSource]="currentImageSource()"
                [processedImageSource]="processedImageSource()" [isLoading]="isLoading()" [mode]="mode()"
                [removalMethod]="removalMethod()" [bgRemovalMode]="bgRemovalMode()" [brushSize]="brushSize()"
                [cropAspectRatio]="cropAspectRatio()" (pointSelected)="onPreviewPointSelected($event)"
                (colorPicked)="onPreviewColorPicked($event)" (canvasHistoryChange)="onHistoryChange($event)">
            </app-editor-preview>

            <!-- Controls -->
            <app-editor-controls [mode]="mode()" [(contrast)]="contrast" [(brightness)]="brightness"
                [(sharpness)]="sharpness" [(upscaleFactor)]="upscaleFactor" [(upscaleDetailBoost)]="upscaleDetailBoost"
                [(bgRemovalMode)]="bgRemovalMode" [(smartRefine)]="smartRefine" [(selectedColors)]="selectedColors"
                [(colorTolerance)]="colorTolerance" [(removalMethod)]="removalMethod" [(brushSize)]="brushSize"
                [lastClickCoords]="lastClickCoords()" [(dotSize)]="dotSize" [(halftoneScale)]="halftoneScale"
                [(halftoneSpacing)]="halftoneSpacing" [(cropAspectRatio)]="cropAspectRatio"
                [canvasHistoryLength]="canvasHistoryLength()" (undo)="previewComponent.undo()"
                (clearCanvas)="previewComponent.clearCanvas()">
            </app-editor-controls>

            <div class="action-buttons">
                @if (processedImageSource()) {
                <div class="filename-input">
                    <input type="text" [(ngModel)]="customFilename" placeholder="nombre-archivo">
                    <span>.png</span>
                </div>
                }
                <button class="btn-secondary btn-pill" (click)="reset()">Subir otra</button>
                @if (processedImageSource()) {
                <button class="btn-secondary btn-pill session" (click)="addToGallery()">
                    <i class="ph ph-arrow-counter-clockwise"></i> Guardar para reusar
                </button>
                }
                <button class="btn-primary btn-pill" (click)="process()">Procesar Imagen</button>
                @if (processedImageSource()) {
                <a [href]="processedImageSource()" class="btn-success btn-pill"
                    [download]="(customFilename || 'resultado') + '.png'">Descargar</a>
                }
            </div>
            }
        </div>

        <!-- Session Sidebar -->
        @if (sessionGallery().length > 0) {
        <app-editor-sidebar [galleryItems]="sessionGallery()" (imageSelected)="loadFromGallery($event)"
            (imageDeleted)="deleteFromGallery($event)">
        </app-editor-sidebar>
        }
    </div>
</div>