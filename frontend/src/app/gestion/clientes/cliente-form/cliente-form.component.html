<div class="form-container">
    <div class="header">
        <div class="title-section">
            <button class="btn-back" (click)="cancel()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div>
                <h1>{{ isEditMode ? 'Editar Cliente' : 'Nuevo Cliente' }}</h1>
                <p>{{ isEditMode ? 'Actualiza los datos de tu cliente.' : 'Registra un nuevo cliente para agilizar tus
                    ventas.' }}</p>
            </div>
        </div>
    </div>

    <div class="form-grid">
        <!-- Main Info Card -->
        <div class="card main-form">
            <div class="card-header">
                <h3>Información General</h3>
            </div>
            <div class="card-body">
                <div class="input-group">
                    <label>Nombre Completo *</label>
                    <input type="text" [(ngModel)]="client.full_name" placeholder="Ej. Juan Pérez">
                </div>

                <div class="row">
                    <div class="input-group">
                        <label>Teléfono *</label>
                        <input type="text" [(ngModel)]="client.phone_number" placeholder="Ej. 1234 5678">
                    </div>
                    <div class="input-group">
                        <label>Email (Opcional)</label>
                        <input type="email" [(ngModel)]="client.email" placeholder="ejemplo@correo.com">
                    </div>
                </div>

                <div class="row">
                    <div class="input-group">
                        <label>Tipo de Cliente</label>
                        <select [(ngModel)]="client.client_type">
                            <option value="retail">Minorista</option>
                            <option value="wholesale">Mayorista</option>
                            <option value="reseller">Revendedor</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>NIT / RFC / ID Fiscal (Opcional)</label>
                        <input type="text" [(ngModel)]="client.tax_id" placeholder="ID de facturación">
                    </div>
                </div>

                <div class="input-group">
                    <label>Dirección de Envío</label>
                    <textarea rows="2" [(ngModel)]="client.shipping_address"
                        placeholder="Calle, número, colonia, código postal..."></textarea>
                </div>

                <div class="input-group">
                    <label>Notas Internas</label>
                    <textarea rows="2" [(ngModel)]="client.notes"
                        placeholder="Detalles importantes sobre este cliente..."></textarea>
                </div>
            </div>
        </div>

        <!-- Preferences Card -->
        <div class="card preferences-form">
            <div class="card-header">
                <h3>Venta Inteligente (Preferencias)</h3>
                <p>Configura estos datos para auto-sugerir en pedidos.</p>
            </div>
            <div class="card-body">
                <div class="input-group">
                    <label>Talla Habitual</label>
                    <div class="size-selector">
                        <button *ngFor="let size of sizes" [class.active]="client.preferences.default_size === size"
                            (click)="client.preferences.default_size = size">
                            {{ size }}
                        </button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Corte / Fit Preferido</label>
                    <input type="text" [(ngModel)]="client.preferences.preferred_fit"
                        placeholder="Ej. Oversized, Slim Fit...">
                </div>

                <div class="input-group">
                    <label>Técnica Habitual</label>
                    <select [(ngModel)]="client.preferences.preferred_technique">
                        <option value="">Seleccionar...</option>
                        <option *ngFor="let t of techniques" [value]="t">{{ t }}</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Horario de Entrega Preferido</label>
                    <select [(ngModel)]="client.preferences.delivery_window">
                        <option value="">Cualquiera</option>
                        <option *ngFor="let w of windows" [value]="w">{{ w }}</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Canal de Comunicación</label>
                    <div class="pill-selector">
                        <button *ngFor="let ch of channels"
                            [class.active]="client.preferences.communication_channel === ch"
                            (click)="client.preferences.communication_channel = ch">
                            {{ ch }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="form-actions">
        <button class="btn-cancel" (click)="cancel()">Cancelar</button>
        <button class="btn-submit" (click)="saveClient()" [disabled]="isSaving">
            <i class="fas fa-save" *ngIf="!isSaving"></i>
            <span class="spinner" *ngIf="isSaving"></span>
            {{ isSaving ? 'Guardando...' : 'Guardar Cliente' }}
        </button>
    </div>
</div>